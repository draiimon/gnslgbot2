"""
Utility for normalizing text, specifically converting fancy unicode characters 
to their ASCII equivalents for better TTS pronunciation.
"""

import re

# Mapping of fancy unicode characters to standard ASCII
UNICODE_MAP = {
    # Bold Uppercase
    'ð€': 'A', 'ð': 'B', 'Cw': 'C', 'ðƒ': 'D', 'ð„': 'E', 'ð…': 'F', 'ð†': 'G', 'ð‡': 'H', 'ðˆ': 'I', 
    'ð‰': 'J', 'ðŠ': 'K', 'ð‹': 'L', 'ðŒ': 'M', 'ð': 'N', 'ðŽ': 'O', 'ð': 'P', 'ð': 'Q', 'ð‘': 'R', 
    'ð’': 'S', 'ð“': 'T', 'ð”': 'U', 'ð•': 'V', 'ð–': 'W', 'ð—': 'X', 'ð˜': 'Y', 'ð™': 'Z',
    
    # Bold Lowercase
    'ðš': 'a', 'ð›': 'b', 'ðœ': 'c', 'ð': 'd', 'ðž': 'e', 'ðŸ': 'f', 'ð ': 'g', 'ð¡': 'h', 'ð¢': 'i', 
    'ð£': 'j', 'ð¤': 'k', 'ð¥': 'l', 'ð¦': 'm', 'ð§': 'n', 'ð¨': 'o', 'ð©': 'p', 'ðª': 'q', 'ð«': 'r', 
    'ð¬': 's', 'ð­': 't', 'ð®': 'u', 'ð¯': 'v', 'ð°': 'w', 'ð±': 'x', 'ð²': 'y', 'ð³': 'z',
    
    # Bold Numbers
    'ðŸŽ': '0', 'ðŸ': '1', 'ðŸ': '2', 'ðŸ‘': '3', 'ðŸ’': '4', 'ðŸ“': '5', 'ðŸ”': '6', 'ðŸ•': '7', 'ðŸ–': '8', 'ðŸ—': '9',
    
    # Italic Uppercase
    'ð´': 'A', 'ðµ': 'B', 'ð¶': 'C', 'ð·': 'D', 'ð¸': 'E', 'ð¹': 'F', 'ðº': 'G', 'ð»': 'H', 'ð¼': 'I', 
    'ð½': 'J', 'ð¾': 'K', 'ð¿': 'L', 'ð‘€': 'M', 'ð‘': 'N', 'ð‘‚': 'O', 'ð‘ƒ': 'P', 'ð‘„': 'Q', 'ð‘…': 'R', 
    'ð‘†': 'S', 'ð‘‡': 'T', 'ð‘ˆ': 'U', 'ð‘‰': 'V', 'ð‘Š': 'W', 'ð‘‹': 'X', 'ð‘Œ': 'Y', 'ð‘': 'Z',
    
    # Italic Lowercase
    'ð‘Ž': 'a', 'ð‘': 'b', 'ð‘': 'c', 'ð‘‘': 'd', 'ð‘’': 'e', 'ð‘“': 'f', 'ð‘”': 'g', 'â„Ž': 'h', 'ð‘–': 'i', 
    'ð‘—': 'j', 'ð‘˜': 'k', 'ð‘™': 'l', 'ð‘š': 'm', 'ð‘›': 'n', 'ð‘œ': 'o', 'ð‘': 'p', 'ð‘ž': 'q', 'ð‘Ÿ': 'r', 
    'ð‘ ': 's', 'ð‘¡': 't', 'ð‘¢': 'u', 'ð‘£': 'v', 'ð‘¤': 'w', 'ð‘¥': 'x', 'ð‘¦': 'y', 'ð‘§': 'z',
    
    # Script Uppercase
    'ð’œ': 'A', 'â„¬': 'B', 'ð’ž': 'C', 'ð’Ÿ': 'D', 'â„°': 'E', 'â„±': 'F', 'ð’¢': 'G', 'â„‹': 'H', 'â„': 'I', 
    'ð’¥': 'J', 'ð’¦': 'K', 'â„’': 'L', 'â„³': 'M', 'ð’©': 'N', 'ð’ª': 'O', 'ð’«': 'P', 'ð’¬': 'Q', 'â„›': 'R', 
    'ð’®': 'S', 'ð’¯': 'T', 'ð’°': 'U', 'ð’±': 'V', 'ð’²': 'W', 'ð’³': 'X', 'ð’´': 'Y', 'ð’µ': 'Z',
    
    # Script Lowercase
    'ð’¶': 'a', 'ð’·': 'b', 'ð’¸': 'c', 'ð’¹': 'd', 'â„¯': 'e', 'ð’»': 'f', 'â„Š': 'g', 'ð’½': 'h', 'ð’¾': 'i', 
    'ð’¿': 'j', 'ð“€': 'k', 'ð“': 'l', 'ð“‚': 'm', 'ð“ƒ': 'n', 'â„´': 'o', 'ð“…': 'p', 'ð“†': 'q', 'ð“‡': 'r', 
    'ð“ˆ': 's', 'ð“‰': 't', 'ð“Š': 'u', 'ð“‹': 'v', 'ð“Œ': 'w', 'ð“': 'x', 'ð“Ž': 'y', 'ð“›': 'z',
    
    # Bold Script Uppercase
    'ð“': 'A', 'ð“‘': 'B', 'ð“’': 'C', 'ð““': 'D', 'ð“”': 'E', 'ð“•': 'F', 'ð“–': 'G', 'ð“—': 'H', 'ð“˜': 'I', 
    'ð“™': 'J', 'ð“š': 'K', 'ð“›': 'L', 'ð“œ': 'M', 'ð“': 'N', 'ð“ž': 'O', 'ð“Ÿ': 'P', 'ð“ ': 'Q', 'ð“¡': 'R', 
    'ð“¢': 'S', 'ð“£': 'T', 'ð“¤': 'U', 'ð“¥': 'V', 'ð“¦': 'W', 'ð“§': 'X', 'ð“¨': 'Y', 'ð“©': 'Z',
    
    # Bold Script Lowercase
    'ð“ª': 'a', 'ð“«': 'b', 'ð“¬': 'c', 'ð“­': 'd', 'ð“®': 'e', 'ð“¯': 'f', 'ð“°': 'g', 'ð“±': 'h', 'ð“²': 'i', 
    'ð“³': 'j', 'ð“´': 'k', 'ð“µ': 'l', 'ð“¶': 'm', 'ð“·': 'n', 'ð“¸': 'o', 'ð“¹': 'p', 'ð“º': 'q', 'ð“»': 'r', 
    'ð“¼': 's', 'ð“½': 't', 'ð“¾': 'u', 'ð“¿': 'v', 'ð”€': 'w', 'ð”': 'x', 'ð”‚': 'y', 'ð”ƒ': 'z',
    
    # Gothic Uppercase
    'ð”„': 'A', 'ð”…': 'B', 'â„­': 'C', 'ð”‡': 'D', 'ð”ˆ': 'E', 'ð”‰': 'F', 'ð”Š': 'G', 'â„Œ': 'H', 'â„‘': 'I', 
    'ð”': 'J', 'ð”Ž': 'K', 'ð”': 'L', 'ð”': 'M', 'ð”‘': 'N', 'ð”’': 'O', 'ð”“': 'P', 'ð””': 'Q', 'â„œ': 'R', 
    'ð”–': 'S', 'ð”—': 'T', 'ð”˜': 'U', 'ð”™': 'V', 'ð”š': 'W', 'ð”›': 'X', 'ð”œ': 'Y', 'â„¨': 'Z',
    
    # Gothic Lowercase
    'ð”ž': 'a', 'ð”Ÿ': 'b', 'ð” ': 'c', 'ð”¡': 'd', 'ð”¢': 'e', 'ð”£': 'f', 'ð”¤': 'g', 'ð”¥': 'h', 'ð”¦': 'i', 
    'ð”§': 'j', 'ð”¨': 'k', 'ð”©': 'l', 'ð”ª': 'm', 'ð”«': 'n', 'ð”¬': 'o', 'ð”­': 'p', 'ð”®': 'q', 'ð”¯': 'r', 
    'ð”°': 's', 'ð”±': 't', 'ð”²': 'u', 'ð”³': 'v', 'ð”´': 'w', 'ð”µ': 'x', 'ð”¶': 'y', 'ð”·': 'z',
    
    # Sans-Serif Bold Uppercase
    'ð—”': 'A', 'ð—•': 'B', 'ð—–': 'C', 'ð——': 'D', 'ð—˜': 'E', 'ð—™': 'F', 'ð—š': 'G', 'ð—›': 'H', 'ð—œ': 'I', 
    'ð—': 'J', 'ð—ž': 'K', 'ð—Ÿ': 'L', 'ð— ': 'M', 'ð—¡': 'N', 'ð—¢': 'O', 'ð—£': 'P', 'ð—¤': 'Q', 'ð—¥': 'R', 
    'ð—¦': 'S', 'ð—§': 'T', 'ð—¨': 'U', 'ð—©': 'V', 'ð—ª': 'W', 'ð—«': 'X', 'ð—¬': 'Y', 'ð—­': 'Z',
    
    # Sans-Serif Bold Lowercase
    'ð—®': 'a', 'ð—¯': 'b', 'ð—°': 'c', 'ð—±': 'd', 'ð—²': 'e', 'ð—³': 'f', 'ð—´': 'g', 'ð—µ': 'h', 'ð—¶': 'i', 
    'ð—·': 'j', 'ð—¸': 'k', 'ð—¹': 'l', 'ð—º': 'm', 'ð—»': 'n', 'ð—¼': 'o', 'ð—½': 'p', 'ð—¾': 'q', 'ð—¿': 'r', 
    'ð˜€': 's', 'ð˜': 't', 'ð˜‚': 'u', 'ð˜ƒ': 'v', 'ð˜„': 'w', 'ð˜…': 'x', 'ð˜†': 'y', 'ð˜‡': 'z',
    
    # Sans-Serif Italic Uppercase
    'ð˜ˆ': 'A', 'ð˜‰': 'B', 'ð˜Š': 'C', 'ð˜‹': 'D', 'ð˜Œ': 'E', 'ð˜': 'F', 'ð˜Ž': 'G', 'ð˜': 'H', 'ð˜': 'I', 
    'ð˜‘': 'J', 'ð˜’': 'K', 'ð˜“': 'L', 'ð˜”': 'M', 'ð˜•': 'N', 'ð˜–': 'O', 'ð˜—': 'P', 'ð˜˜': 'Q', 'ð˜™': 'R', 
    'ð˜š': 'S', 'ð˜›': 'T', 'ð˜œ': 'U', 'ð˜': 'V', 'ð˜ž': 'W', 'ð˜Ÿ': 'X', 'ð˜ ': 'Y', 'ð˜¡': 'Z',
    
    # Sans-Serif Italic Lowercase
    'ð˜¢': 'a', 'ð˜£': 'b', 'ð˜¤': 'c', 'ð˜¥': 'd', 'ð˜¦': 'e', 'ð˜§': 'f', 'ð˜¨': 'g', 'ð˜©': 'h', 'ð˜ª': 'i', 
    'ð˜«': 'j', 'ð˜¬': 'k', 'ð˜­': 'l', 'ð˜®': 'm', 'ð˜¯': 'n', 'ð˜°': 'o', 'ð˜±': 'p', 'ð˜²': 'q', 'ð˜³': 'r', 
    'ð˜´': 's', 'ð˜µ': 't', 'ð˜¶': 'u', 'ð˜·': 'v', 'ð˜¸': 'w', 'ð˜¹': 'x', 'ð˜º': 'y', 'ð˜»': 'z',
    
    # Sans-Serif Bold Italic Uppercase
    'ð˜¼': 'A', 'ð˜½': 'B', 'ð˜¾': 'C', 'ð˜¿': 'D', 'ð™€': 'E', 'ð™': 'F', 'ð™‚': 'G', 'ð™ƒ': 'H', 'ð™„': 'I', 
    'ð™…': 'J', 'ð™†': 'K', 'ð™‡': 'L', 'ð™ˆ': 'M', 'ð™‰': 'N', 'ð™Š': 'O', 'ð™‹': 'P', 'ð™Œ': 'Q', 'ð™': 'R', 
    'ð™Ž': 'S', 'ð™': 'T', 'ð™': 'U', 'ð™‘': 'V', 'ð™’': 'W', 'ð™“': 'X', 'ð™”': 'Y', 'ð™•': 'Z',
    
    # Sans-Serif Bold Italic Lowercase
    'ð™–': 'a', 'ð™—': 'b', 'ð™˜': 'c', 'ð™™': 'd', 'ð™š': 'e', 'ð™›': 'f', 'ð™œ': 'g', 'ð™': 'h', 'ð™ž': 'i', 
    'ð™Ÿ': 'j', 'ð™ ': 'k', 'ð™¡': 'l', 'ð™¢': 'm', 'ð™£': 'n', 'ð™¤': 'o', 'ð™¥': 'p', 'ð™¦': 'q', 'ð™§': 'r', 
    'ð™¨': 's', 'ð™©': 't', 'ð™ª': 'u', 'ð™«': 'v', 'ð™¬': 'w', 'ð™­': 'x', 'ð™®': 'y', 'ð™¯': 'z',
}

def normalize_text(text: str) -> str:
    """
    Convert fancy unicode characters in the text to their ASCII equivalents.
    Example: "ð²ðšð§ð§ðš" -> "yanna"
    """
    if not text:
        return ""
        
    # Step 1: Normalize fancy unicode characters to ASCII
    # We do this FIRST so we don't accidentally strip them as "emojis"
    processed_text = []
    for char in text:
        if char in UNICODE_MAP:
            processed_text.append(UNICODE_MAP[char])
        else:
            processed_text.append(char)
    
    text = "".join(processed_text)

    # Step 2: Remove emojis and symbols using regex
    # Covers: Emoticons, Transport/Map, Enclosed Alphanumeric, Dingbats, Formatting, etc.
    if text:
        text = re.sub(r'[\U00010000-\U0010ffff]', '', text)  # Supplementary Multilingual Plane (Most Emojis)
        text = re.sub(r'[\u2700-\u27bf]', '', text)  # Dingbats
        text = re.sub(r'[\u2600-\u26ff]', '', text)  # Misc Symbols
        text = re.sub(r'[\ufe0f]', '', text)  # Variation Selector
        text = re.sub(r'[\u200d]', '', text)  # Zero Width Joiner
            
    return text.strip()  # Strip leading/trailing whitespace
